extends Node2D

@export var bpm:float = 249
var niveau_actuelle = 4
var chart1 = ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "4", "", "", "", "", "", "", "1", "", "", "", "", "", "", "", "4", "", "", "", "", "", "", "", "1", "", "", "", "", "", "", "", "3", "", "", "", "", "", "", "", "2", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "4", "", "", "", "", "", "", "", "1", "", "", "", "", "", "", "", "2", "", "", "", "", "", "", "", "2", "", "", "", "", "", "", "", "3", "", "", "", "", "", "", "", "3", "", "", "", "", "", "", "", "", "", "", "", "1", "", "", "", "2", "", "", "", "4", "", "", "", "3", "", "", "", "", "", "", "", "3", "", "", "", "", "", "", "", "1", "", "", "", "", "", "", "", "", "", "", "", "", "4", "", "", "", "", "", "", "", "2", "", "", "2", "", "", "", "2", "", "", "", "", "", "", "", "", "", "", "", "", "", "41", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "2", "", "", "", "", "", "", "", "", "", "3", "", "", "", "", "", "", "", "4", "", "", "1", "", "4", "", "", "", "2", "", "", "", "", "", "", "2", "", "", "", "", "", "", "", "3", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "4", "", "", "", "3", "", "", "", "1", "", "", "", "1", "", "", "", "2", "", "", "", "", "", "", "", "", "2", "", "", "2", "", "", "", "2", "", "", "", "", "", "", "", "3", "", "", "", "1", "", "", "", "", "", "", "", "4", "", "", "", "1", "", "", "", "", "", "", "", "", "2", "", "", "", "", "", "", "", "2", "", "", "", "", "", "", "", "3", "", "", "", "", "", "", "", "3", "", "", "", "", "", "", "", "", ""]
var chart2 = ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "14", "", "", "41", "", "", "", "2", "", "", "", "3", "", "2", "", "3", "", "", "", "", "", "", "", "41", "", "", "", "23", "", "", "", "2", "", "", "", "", "", "", "", "", "1", "", "4", "", "1", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "3", "", "", "3", "", "", "", "2", "", "", "", "", "2", "", "", "1", "", "", "", "1", "", "", "", "4", "", "", "", "4", "", "", "", "2", "", "", "", "3", "", "", "", "14", "", "", "", "2", "", "", "", "", "", "", "", "4", "", "1", "", "4", "", "1", "", "", "", "", "", "3", "", "2", "", "3", "", "2", "", "3", "", "", "", "", "", "", "", "4", "", "", "", "", "", "", "", "1", "", "1", "", "4", "", "", "", "", "2", "2", "", "3", "", "2", "", "2", "", "3", "", "2", "", "", "", "1", "", "", "", "", "", "", "", "4", "", "", "", "", "", "", "", "3", "", "", "", "1", "", "", "", "41", "", "", "", "2", "", "", "", "2", "", "", "", "", "", "", "", "3", "", "1", "", "", "", "", "", "3", "", "4", "", "", "", "", "", "2", "", "1", "", "", "", "", "", "2", "4", "", "", "", "", "", "", "3", "", "1", "", "4", "", "", "2", "", "", "1", "", "", "", "", "", "2", "", "4", "3", "", "", "", "", "14", "", "", "", "14", "", "", "", "2", "", "", "", "", "", "", "", "3", "", "", "", "1", "", "", "", "4", "", "", "", "1", "", "", "", "", "", "", "", "2", "", "", "", "3", "", "", "", "3", "", "", "", "1", "", "", "", "1", "", "", "", "4", "", "2", "", "2", "", "", "", "", "", "", "", "", "", "", "", "2", "", "", "", "3", "", "", "", "", "1", "", "", "", "", "", "", "", "4", "", "", "", "4", "", "", "", "41", "", "32", "", "", "", "", "", "41", "", "2", "3", "", "", "", "", "", "1", "", "", "", "4", ""]
var chart3 = ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "2", "", "", "2", "", "", "", "3", "", "", "", "3", "", "", "", "1", "4", "1", "", "", "", "", "", "1", "4", "1", "", "", "", "", "", "", "14", "1", "", "", "", "", "", "1", "4", "1", "", "", "", "", "", "2", "", "3", "", "2", "", "3", "", "23", "", "23", "", "32", "", "32", "", "1", "4", "2", "3", "2", "4", "1", "3", "2", "4", "1", "3", "2", "4", "1", "3", "2", "", "2", "", "2", "", "2", "", "3", "", "3", "", "3", "", "3", "", "1", "", "", "", "4", "", "", "", "2", "31", "4", "2", "3", "", "", "", "", "", "", "", "2", "3", "23", "23", "14", "1", "", "", "23", "2", "3", "", "1", "", "1", "", "", "1", "1", "", "4", "", "4", "", "4", "", "4", "", "2", "", "3", "", "2", "", "2", "", "3", "", "3", "", "3", "", "2", "", "4", "", "4", "", "4", "", "1", "", "3", "", "2", "4", "1", "", "3", "", "2", "", "4", "", "1", "", "3", "", "3", "", "2", "", "2", "", "4", "", "1", "", "4", "", "1", "4", "1", "", "3", "2", "3", "2", "3", "2", "3", "", "1", "", "4", "", "1", "", "4", "", "2", "3", "2", "", "1", "", "1", "", "4", "", "4", "", "4", "2", "", "", "3", "", "", "3", "", "", "", "", "4", "", "", "", "3", "", "", "1", "", "", "", "2", "", "", "", "", "4", "", "4", "", "1", "", "", "", "2", "3", "2", "3", "2", "", "", "", "1", "", "1", "", "4", "", "4", "", "2", "", "", "", "3", "", "2", "", "1", "", "1", "", "4", "", "4", "", "3", "", "2", "", "3", "", "", "", "", "", ""]
var chart4 = []
var chart5 = []

var secretchart = ["", "", "", "", "", "", "", "143", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "2", "", "", "", "14", "3", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "42", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "134", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "23", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "14", "2", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "3", "", "", "", "124", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "13", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "23", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "24", "", "", "", "", "31", "", "", "", "42", "", "", "", "", "", "", "", "", "413", "", "24", "31", "24", "3", "41", "32", "4", "314", "23", "4", "134", "2", "14", "23", "4", "13", "24", "31", "4", "23", "413", "", "243", "14", "23", "4", "13", "24", "13", "4", "23", "14", "32", "4", "13", "24", "31", "4", "32", "4", "13", "42", "31", "4", "23", "41", "32", "4", "314", "2", "34", "13", "24", "1", "2", "3", "41", "3", "24", "13", "42", "3", "14", "2", "34", "13", "24", "3", "1", "42", "3", "14", "32", "41", "32", "4", "31", "4", "3", "41", "32", "41", "32", "4", "31", "42", "3", "41", "32", "4", "13", "42", "", "14", "23", "41", "32", "4", "1", "342", "3", "14", "23", "41", "342", "3", "41", "", "342", "", "4", "4", "", "34", "12", "34", "4", "1", "2", "", "1", "2", "34", "", "3", "4", "1", "32", "4", "31", "42", "3", "4", "3", "14", "23", "4", "13", "24", "3", "14", "23", "", "413", "24", "13", "", "243", "14", "23", "", "41", "324", "1", "324", "31", "", "24", "31", "42", "3", "14", "32", "4", "13", "24", "3", "124", "3", "14", "3", "24", "13", "2", "4", "314", "2", "3", "41", "32", "4", "13", "24", "", "134", "23", "", "14", "32", "41", "3", "", "241", "3", "24", "3", "14", "23", "14", "", "32", "41", "3", "24", "13", "2", "4", "1", "324", "", "31", "42", "3", "14", "3", "2", "41", "3", "2", "4", "3", "1", "2", "43", "1", "4", "31", "", "24", "3", "12", "4", "31", "24", "3", "1", "42", "3", "142", "4", "3", "4", "3", "4", "34", "3", "4", "4", "3", "", "4", "3", "4", "4", "34", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]

var ordre_chart = [0,chart1 , chart2, chart3, chart4,chart5]
#var chart = ["1", "2"] #test
@export var vertical_mode = true

func _ready() -> void:
	new_game()
	
func play_song(playingChart):
	## This will create a note each beat based on the chart var
	## uses a timer to wait between each note
	$clock.wait_time = 60 / bpm
	$clock.start()
	for i in playingChart:
		for j in i.split():
			find_child("ZonePartition").create_note(int(j))
			
		#wait between each note
		await $clock.timeout
		
	#song finished here
	if find_child("ZonePartition").taux_alcoolémie >= 10 :
		if find_child("ZonePartition").nmbr_miss == 0 :
			$winnertext/winnertextlabel.text = "Only Sushi Ending"
		else:
			$winnertext/winnertextlabel.text = "Alcoolo Ending"
	elif find_child("ZonePartition").taux_alcoolémie == 0 :
		if find_child("ZonePartition").nmbr_miss == 0 :
			$winnertext/winnertextlabel.text = "V.N.G.O.G Ending"
		else :
			$winnertext/winnertextlabel.text = "Sobre Ending"
	else :
		$winnertext/winnertextlabel.text = "Ok Ending"
	if find_child("ZonePartition").nmbr_miss == 0 :
		$winnertext/RankLabel.text = "X"
	elif find_child("ZonePartition").nmbr_miss < 2 :
		$winnertext/RankLabel.text = "S"
	elif find_child("ZonePartition").nmbr_miss < 5 :
		$winnertext/RankLabel.text = "A"
	elif find_child("ZonePartition").nmbr_miss < 10 :
		$winnertext/RankLabel.text = "B"
	elif find_child("ZonePartition").nmbr_miss < 20 :
		$winnertext/RankLabel.text = "C"
	elif find_child("ZonePartition").nmbr_miss < 30 :
		$winnertext/RankLabel.text = "D"
	else :
		$winnertext/RankLabel.text = "Z-"
	$winnertext.show()


func _on_delay_timeout() -> void:
	$Music.play()


func _on_button_pressed() -> void:
	niveau_actuelle += 1
	new_game()
	
func new_game():
	$winnertext.hide()
	if vertical_mode:
		$ZonePartition.rotation_degrees -= 90
	if name == "secretlevel":
		play_song(secretchart)
	else:
		play_song(ordre_chart[niveau_actuelle]) #es arrive to the playing area
	$Music/delay.start()
	
