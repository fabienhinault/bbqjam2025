extends Node2D

@export var bpm:float = 249
#var chart = ["", "", "", "", "3", "3", "32", "4", "1", "3", "2", "4", "", "2", "31", "", "32", "4", "2", "3", "", "3", "1", "3", "2", "4", "2", "3", "1", "3", "2", "4", "", "1", "3", "2", "", "", "1", "3", "2", "4", "2", "3", "1", "3", "2", "4", "", "13", "3", "1", "", "", "", "24", "1", "3", "2", "2", "4", "1", "3", "3", "", "2", "", "4", "1", "3", "2", "4", "1", "3", "2", "4", "2", "3", "1", "", "", "4", "2", "4", "2", "4", "2", "", "31", "4", "2", "3", "1", "3", "", "", "", "2", "", "4", "", "1", "", "1", "", "2", "3", "4", "3", "2", "", "1", "", "1", "", "23", "2", "3", "2", "3", "2", "4", "23", "23", "23", "23", "23", "23", "23", "24", "", "", "", "4", "3", "", "1", "31", "3", "", "", "2", "", "", "", "1", "2", "3", "4", "3", "2", "1", "2", "3", "4", "3", "2", "1", "2", "3", "4", "3", "", "", "", "2", "3", "", "", "", "14", "1", "4", "2", "3", "", "", "1", "3", "2", "4", "1", "3", "2", "3", "1", "4", "2", "3", "2", "", "", "", "", "", ""]
var chart = ["", "", "", "4", "4", "4", "4", "4", "3", "2", "1", "3", "", "2", "41", "3", "", "", "3", "", "3", "", "3", "", "", "32", "3", "3", "4", "3", "4", "4", "3", "", "1", "1", "1", "", "", "", "4", "3", "3", "", "21", "1", "1", "1", "", "", "2", "3", "2", "", "", "", "4", "3", "2", "3", "2", "4", "1", "3", "2", "", "2", "3", "2", "", "1", "43", "2", "1", "3", "2", "1", "2", "4", "", "", "", "", "23", "23", "2", "3", "2", "1", "2", "3", "1", "2", "2", "4", "", "", "", "2", "1", "2", "", "", "4", "3", "2", "3", "2", "1", "2", "3", "", "", "", "2", "4", "24", "2", "4", "3", "4", "3", "", "21", "4", "2", "3", "1", "4", "2", "3", "1", "", "42", "", "32", "3", "23", "2", "1", "24", "3", "2", "3", "1", "", "3", "24", "3", "4", "4", "2", "", "42", "3", "1", "2", "4", "1", "", "", "", "13", "", "42", "", "", "31", "4", "3", "4", "2", "3", "1", "2", "4", "", "", "", "1", "24", "", "3", "1", "42", "3", "1", "4", "2", "3", "1", "", "", "", "1", "2", "4", "", "", "2", "3", "1", "4", "2", "3", "1", "3", "4", "3", "", "2", "3", "1", "4", "3", "4", "2", "4", "2", "3", "4", "3", "2", "1", "3", "2", "1", "", "2", "", "", "1", "3", "4", "3", "2", "2", "1", "3", "1", "3", "1", "4", "3", "4", "3", "4", "3", "2", "1", "3", "2", "4", "1", "3", "", "2", "4", "34", "", "3", "1", "4", "2", "3", "1", "4", "2", "3", "2", "4", "4", "3", "1", "1", "2", "1", "2", "3", "4", "3", "4", "2", "2", "3", "1", "1", "2", "3", "", "3", "2", "3", "3", "4", "2", "1", "4", "2", "3", "1", "4", "3", "4", "2", "", "2", "3", "1", "4", "2", "3", "1", "2", "4", "3", "1", "2", "3", "", "13", "2", "", "4", "", "1", "3", "2", "4", "", "23", "1", "4", "2", "3", "3", "", "", "1", "4", "2", "3", "1", "4", "2", "3", "1", "4", "2", "", "3", "1", "4", "2", "3", "1", "4", "3", "2", "4", "1", "3", "2", "1", "", "24", "3", "", "4", "1", "3", "2", "4", "1", "3", "2", "4", "1", "3", "2", "4", "1", "3", "4", "3", "2", "4", "3", "1", "3", "2", "4", "3", "1", "", "2", "1", "3", "4", "3", "24", "", "3", "1", "", "2", "3", "4", "1423", "4132", "4312", "3124", "", "", "", "", "", "", ""]
var chart2 = ["", "", "", "", "", "", "", "143", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "2", "", "", "", "14", "3", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "42", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "134", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "23", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "14", "2", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "3", "", "", "", "124", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "13", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "23", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "24", "", "", "", "", "31", "", "", "", "42", "", "", "", "", "", "", "", "", "413", "", "24", "31", "24", "3", "41", "32", "4", "314", "23", "4", "134", "2", "14", "23", "4", "13", "24", "31", "4", "23", "413", "", "243", "14", "23", "4", "13", "24", "13", "4", "23", "14", "32", "4", "13", "24", "31", "4", "32", "4", "13", "42", "31", "4", "23", "41", "32", "4", "314", "2", "34", "13", "24", "1", "2", "3", "41", "3", "24", "13", "42", "3", "14", "2", "34", "13", "24", "3", "1", "42", "3", "14", "32", "41", "32", "4", "31", "4", "3", "41", "32", "41", "32", "4", "31", "42", "3", "41", "32", "4", "13", "42", "", "14", "23", "41", "32", "4", "1", "342", "3", "14", "23", "41", "342", "3", "41", "", "342", "", "4", "4", "", "34", "12", "34", "4", "1", "2", "", "1", "2", "34", "", "3", "4", "1", "32", "4", "31", "42", "3", "4", "3", "14", "23", "4", "13", "24", "3", "14", "23", "", "413", "24", "13", "", "243", "14", "23", "", "41", "324", "1", "324", "31", "", "24", "31", "42", "3", "14", "32", "4", "13", "24", "3", "124", "3", "14", "3", "24", "13", "2", "4", "314", "2", "3", "41", "32", "4", "13", "24", "", "134", "23", "", "14", "32", "41", "3", "", "241", "3", "24", "3", "14", "23", "14", "", "32", "41", "3", "24", "13", "2", "4", "1", "324", "", "31", "42", "3", "14", "3", "2", "41", "3", "2", "4", "3", "1", "2", "43", "1", "4", "31", "", "24", "3", "12", "4", "31", "24", "3", "1", "42", "3", "142", "4", "3", "4", "3", "4", "34", "3", "4", "4", "3", "", "4", "3", "4", "4", "34", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]

#var chart = ["1", "2"] #test
@export var vertical_mode = true

func _ready() -> void:
	if vertical_mode:
		$ZonePartition.rotation_degrees -= 90
	if name == "secretlevel":
		play_song(chart2)
	else:
		play_song(chart)
	## sync song with chart
	# accounts for the time that notes arrive to the playing area
	$Music/delay.start() 
	
func play_song(playingChart):
	## This will create a note each beat based on the chart var
	## uses a timer to wait between each note
	$clock.wait_time = 60 / bpm
	$clock.start()
	for i in playingChart:
		for j in i.split():
			find_child("ZonePartition").create_note(int(j))
			
		#wait between each note
		await $clock.timeout
		
	#song finished here


func _on_delay_timeout() -> void:
	$Music.play()
